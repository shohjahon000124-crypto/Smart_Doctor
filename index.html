<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- 1 -->
  <!-- 2 -->
  <!-- 3 -->
  <!-- Meta tags for proper rendering and responsiveness -->
  <meta charset="UTF-8">
  <!-- 5 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <!-- 7 -->
  <title>SmartDoctor ‚Ä¢ –£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –∑–¥–æ—Ä–æ–≤—å—è</title>
  <!-- 9 -->
  <!-- Fonts and icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- 11 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <!-- 13 -->
  <!-- Main styles -->
  <style>
    /* 15 */
    /* Root variables for easy theming */
    :root {
      --primary: #00d4c1;
      --primary-dark: #00a89a;
      --accent: #1a3198;
      --card: rgba(255, 255, 255, 0.97);
      --text: #2c4248;
      --light: #f8f9fa;
      --bg-light: linear-gradient(135deg, #1b38bb 0%, #1249c0 100%);
      --input-bg: white;
      --border: #eee;
      --shadow: 0 20px 60px rgba(0,0,0,0.3);
      --transition: all 0.4s ease;
    }
    /* 30 */
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: manipulation;
    }
    /* 37 */
    body, html {
      font-family: 'Inter', sans-serif;
      background: var(--bg, var(--bg-light));
      height: 100%;
      color: var(--text);
      overflow: hidden;
      transition: background 0.8s ease;
    }
    /* 45 */
    /* Main container */
    .container {
      width: 100%;
      max-width: 1400px;
      margin: 10px auto;
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
      height: calc(100vh - 20px);
      display: flex;
      flex-direction: column;
    }
    /* 57 */
    /* Auth screen styles */
    #authScreen {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }
    /* 67 */
    #authScreen::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg at 50% 50%, transparent, var(--primary), transparent);
      opacity: 0.15;
      animation: rotate 20s linear infinite;
      pointer-events: none;
    }
    /* 79 */
    @keyframes rotate {
      100% { transform: rotate(360deg); }
    }
    /* 82 */
    .auth-content {
      position: relative;
      z-index: 2;
      text-align: center;
      max-width: 420px;
      width: 100%;
    }
    /* 89 */
    .auth-icon {
      font-size: 80px;
      color: var(--primary);
      margin-bottom: 20px;
      animation: float 4s ease-in-out infinite;
    }
    /* 95 */
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    /* 99 */
    .auth-logo {
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 16px;
    }
    /* 107 */
    .auth-subtitle {
      font-size: 18px;
      color: #555;
      margin-bottom: 40px;
      opacity: 0.9;
    }
    /* 113 */
    .auth-box {
      background: white;
      padding: 45px 35px 70px 35px;
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      width: 100%;
      max-width: 420px;
    }
    /* 122 */
    .auth-box h2 {
      font-size: 28px;
      margin-bottom: 30px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align: center;
    }
    /* 130 */
    .auth-box input {
      width: 100%;
      padding: 18px 20px;
      margin: 14px 0;
      border: 2px solid #eee;
      border-radius: 16px;
      font-size: 17px;
      transition: all 0.3s;
    }
    /* 139 */
    .auth-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 5px rgba(0,212,193,0.2);
    }
    /* 144 */
    .auth-box button {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 19px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 25px;
      transition: 0.4s;
      box-shadow: 0 8px 25px rgba(0,212,193,0.3);
    }
    /* 157 */
    .auth-box button:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 35px rgba(0,212,193,0.4);
    }
    /* 161 */
    .toggle-link {
      margin-top: 28px;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      font-size: 17px;
      transition: 0.3s;
    }
    /* 169 */
    .toggle-link:hover {
      text-decoration: underline;
    }
    /* 172 */
    /* Header styles */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      flex-shrink: 0;
    }
    /* 183 */
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    /* 188 */
    .logo {
      font-size: 28px;
      color: white;
    }
    /* 192 */
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    /* 199 */
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.25);
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 14px;
      backdrop-filter: blur(10px);
    }
    /* 210 */
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
      transition: var(--transition);
    }
    /* 218 */
    .user-avatar:hover {
      transform: scale(1.1);
    }
    /* 221 */
    .logout, .settings-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
    }
    /* 232 */
    .logout:hover, .settings-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }
    /* 236 */
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    /* 246 */
    .modal.open {
      display: flex;
    }
    /* 249 */
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 24px;
      width: 90%;
      max-width: 550px;
      box-shadow: var(--shadow);
      text-align: center;
      max-height: 90vh;
      overflow-y: auto;
    }
    /* 260 */
    .modal h3 {
      margin-bottom: 25px;
      font-size: 26px;
      font-weight: 700;
      color: var(--primary);
    }
    /* 266 */
    .settings-section {
      margin-bottom: 35px;
      padding: 20px;
      background: rgba(0,212,193,0.05);
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    }
    /* 273 */
    .settings-section h4 {
      font-size: 20px;
      margin-bottom: 18px;
      color: var(--primary);
      font-weight: 600;
      text-align: center;
    }
    /* 280 */
    .current-avatar-preview {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary);
      margin: 20px auto;
      box-shadow: 0 8px 25px rgba(0,212,193,0.3);
    }
    /* 289 */
    .language-selector {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    /* 295 */
    .lang-flag {
      font-size: 32px;
      cursor: pointer;
      transition: 0.3s;
      opacity: 0.6;
    }
    /* 301 */
    .lang-flag.active {
      opacity: 1;
      transform: scale(1.2);
    }
    /* 305 */
    .bg-options, .avatar-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    /* 310 */
    .bg-option, .avatar-option {
      height: 110px;
      border-radius: 16px;
      cursor: pointer;
      border: 4px solid transparent;
      transition: var(--transition);
      background-size: cover;
      background-position: center;
    }
    /* 319 */
    .bg-option.active, .avatar-option.active {
      border-color: var(--primary);
      transform: scale(1.08);
      box-shadow: 0 10px 30px rgba(0,212,193,0.4);
    }
    /* 324 */
    .avatar-option {
      background-size: contain;
      background-repeat: no-repeat;
      background-color: #f0f8ff;
    }
    /* 329 */
    .modal-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }
    /* 334 */
    .modal-btn {
      flex: 1;
      padding: 14px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition);
    }
    /* 345 */
    .modal-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-3px);
    }
    /* 349 */
    .modal-btn.secondary {
      background: #95a5a6;
    }
    /* 352 */
    /* Main layout */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    /* 359 */
    .chat-section {
      flex: 1;
      background: var(--light);
      display: flex;
      flex-direction: column;
    }
    /* 365 */
    .chat-controls {
      display: flex;
      gap: 10px;
      padding: 12px 20px;
      justify-content: flex-end;
      background: var(--card);
      border-bottom: 1px solid var(--border);
      flex-wrap: wrap;
    }
    /* 374 */
    .chat-btn {
      padding: 10px 18px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(0,212,193,0.2);
    }
    /* 385 */
    .chat-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    /* 389 */
    .chat-window {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      justify-content: flex-end;
    }
    /* 398 */
    .message {
      max-width: 75%;
      padding: 14px 20px;
      border-radius: 20px;
      line-height: 1.6;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      word-wrap: break-word;
      font-size: 15.5px;
      animation: msgIn 0.5s ease-out;
    }
    /* 408 */
    @keyframes msgIn {
      from { opacity: 0; transform: translateY(30px) scale(0.9); }
      to { opacity: 1; transform: none; }
    }
    /* 412 */
    .message.user {
      align-self: flex-end;
      background: var(--primary);
      color: white;
      border-bottom-right-radius: 6px;
    }
    /* 418 */
    .message.ai {
      align-self: flex-start;
      background: var(--card);
      color: var(--text);
      border: 1px solid var(--border);
      border-bottom-left-radius: 6px;
    }
    /* 425 */
    .typing-indicator {
      align-self: flex-start;
      background: var(--card);
      border: 1px solid var(--border);
      padding: 14px 20px;
      border-radius: 20px;
      border-bottom-left-radius: 6px;
      font-style: italic;
      color: #888;
    }
    /* 435 */
    .input-area {
      padding: 14px 18px;
      background: var(--card);
      border-top: 1px solid var(--border);
      display: flex;
      gap: 14px;
      align-items: center;
      flex-shrink: 0;
    }
    /* 444 */
    .input-area input {
      flex: 1;
      padding: 16px 22px;
      border: 2px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      border-radius: 50px;
      font-size: 16px;
    }
    /* 453 */
    .input-area button {
      width: 52px;
      height: 52px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 22px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 6px 20px rgba(0,212,193,0.3);
    }
    /* 464 */
    .input-area button:hover {
      transform: scale(1.1);
    }
    /* 467 */
    /* Doctors section */
    .doctors-section {
      background: var(--card);
      padding: 20px;
      overflow-y: auto;
      width: 380px;
      border-left: 1px solid var(--border);
      flex-shrink: 0;
      transition: transform 0.4s ease;
    }
    /* 476 */
    .doctors-toggle {
      display: none;
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 26px;
      box-shadow: 0 10px 30px rgba(0,212,193,0.5);
      cursor: pointer;
      z-index: 100;
      transition: var(--transition);
    }
    /* 494 */
    .doctors-toggle:hover {
      transform: scale(1.15);
    }
    /* 497 */
    .search-box {
      margin-bottom: 20px;
      position: relative;
    }
    /* 501 */
    .search-box input {
      width: 100%;
      padding: 16px 50px 16px 22px;
      border: 2px solid var(--border);
      background: var(--input-bg);
      color: var(--text);
      border-radius: 50px;
      font-size: 16px;
    }
    /* 510 */
    .search-box i {
      position: absolute;
      right: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: #aaa;
      font-size: 20px;
    }
    /* 518 */
    .doctor-card {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      transition: var(--transition);
    }
    /* 526 */
    .doctor-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    }
    /* 530 */
    .doc-header {
      display: flex;
      padding: 18px;
      gap: 16px;
      align-items: center;
    }
    /* 536 */
    .doc-header img {
      width: 75px;
      height: 75px;
      border-radius: 16px;
      object-fit: cover;
      border: 4px solid var(--primary);
      transition: var(--transition);
    }
    /* 544 */
    .doc-header img:hover {
      transform: scale(1.05);
    }
    /* 547 */
    .doc-info h3 {
      font-size: 17px;
      margin-bottom: 6px;
      color: var(--text);
      font-weight: 600;
    }
    /* 553 */
    .specialty {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 8px 16px;
      border-radius: 30px;
      font-size: 14px;
    }
    /* 560 */
    .rating {
      color: #f1c40f;
      font-size: 17px;
      font-weight: bold;
      margin: 8px 0;
    }
    /* 566 */
    .doc-footer {
      background: linear-gradient(135deg, #f0fffe, #e6fffa);
      padding: 18px;
      text-align: center;
    }
    /* 571 */
    .call-btn, .book-btn {
      padding: 14px 32px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      text-decoration: none;
      display: block;
      margin-top: 10px;
      transition: var(--transition);
    }
    /* 586 */
    .book-btn {
      background: #667eea;
    }
    /* 589 */
    .call-btn:hover, .book-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    /* 593 */
    /* Admin panel */
    .admin-panel {
      padding: 35px;
      flex: 1;
      overflow-y: auto;
    }
    /* 599 */
    table {
      width: 100%;
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    /* 606 */
    th {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 22px;
      font-size: 17px;
    }
    /* 612 */
    td {
      padding: 18px;
      border-bottom: 1px solid var(--border);
      color: var(--text);
    }
    /* 617 */
    tr:hover td {
      background: #f0fffe;
      transition: 0.3s;
    }
    /* 621 */
    #topSymptoms {
      margin: 30px 0;
      padding: 25px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }
    /* 628 */
    #topSymptoms ul {
      list-style: none;
    }
    /* 631 */
    #topSymptoms li {
      padding: 14px;
      background: rgba(0,212,193,0.12);
      margin: 10px 0;
      border-radius: 14px;
      font-size: 16px;
    }
    /* 638 */
    /* Media queries for responsiveness */
    @media (min-width: 992px) {
      .main { flex-direction: row; }
      .chat-section { flex: 2.5; }
      .doctors-toggle { display: none !important; }
    }
    /* 644 */
    @media (max-width: 991px) {
      .doctors-section {
        position: fixed;
        top: 0;
        right: 0;
        height: 100%;
        width: 90%;
        max-width: 380px;
        z-index: 99;
        transform: translateX(100%);
        background: var(--card);
      }
      .doctors-section.open { transform: translateX(0); }
      .doctors-toggle { display: block; }
    }
    /* 658 */
    @media (max-width: 480px) {
      .auth-logo { font-size: 40px; }
      .auth-icon { font-size: 70px; }
      .auth-box { padding: 40px 25px 80px 25px; }
      .modal-content { padding: 20px; }
    }
    /* 664 */

    /* –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞—è–≤–æ–∫ */
    .appointments-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .appointments-table thead th {
      background: linear-gradient(135deg, #00d4c1, #00a89a);
      color: #fff;
      padding: 12px;
    }
    .appointments-table td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      background: #fff;
    }
    .appointments-table button {
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 700;
      margin-right: 6px;
    }
    .appointments-table .accept { background: #2ecc71; color: #fff; }
    .appointments-table .reject { background: #e74c3c; color: #fff; }
  </style>
</head>
<body>
  <!-- 666 -->
  <!-- Main container -->
  <div class="container">
    <!-- 668 -->
    <!-- Auth screen -->
    <div id="authScreen">
      <!-- 670 -->
      <div class="auth-content">
        <!-- 671 -->
        <div class="auth-icon"><i class="fas fa-heartbeat"></i></div>
        <!-- 672 -->
        <div class="auth-logo" data-tr="SmartDoctor">SmartDoctor</div>
        <!-- 673 -->
        <p class="auth-subtitle" data-tr="–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é <br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ">–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é<br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ</p>
        <!-- 674 -->
        <div class="auth-box">
          <!-- 675 -->
          <h2 id="authTitle" data-tr="–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h2>
          <!-- 676 -->
          <input type="email" id="email" placeholder="Email" required>
          <!-- 677 -->
          <input type="text" id="firstName" placeholder="–ò–º—è" style="display:none;">
          <!-- 678 -->
          <input type="text" id="lastName" placeholder="–§–∞–º–∏–ª–∏—è" style="display:none;">
         
          <!-- 679 -->
          <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (+992...)" style="display:none;">
          <!-- 680 -->
          <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
          <!-- 681 -->
          <button id="authBtn" data-tr="–í–æ–π—Ç–∏">–í–æ–π—Ç–∏</button>
          <!-- 682 -->
          <div class="toggle-link" id="toggleLink" data-tr="–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</div>
          <!-- 683 -->
        </div>
        <!-- 684 -->
      </div>
      <!-- 685 -->
    </div>
    <!-- Patient app -->
    <div id="patientApp" style="display:none; flex-direction:column; height:100%;">
      <!-- 687 -->
      <div class="header">
        <!-- 688 -->
        <div class="header-left">
          <!-- 689 -->
          <div class="logo" data-tr="SmartDoctor">SmartDoctor</div>
          <!-- 690 -->
        </div>
        <!-- 691 -->
        <div class="header-right">
          <!-- 692 -->
          <div class="user-info">
            <!-- 693 -->
            <img class="user-avatar" id="userAvatar" src="https://randomuser.me/api/portraits/men/1.jpg">
            <!-- 694 -->
            <span id="userName"></span>
            <!-- 695 -->
          </div>
          <!-- 696 -->
          <button class="settings-btn" id="settingsBtn"><i class="fas fa-cog"></i></button>
          <!-- 697 -->
          <button class="logout" id="logoutPatient" data-tr="–í—ã–π—Ç–∏">–í—ã–π—Ç–∏</button>
          <!-- 698 -->
        </div>
        <!-- 699 -->
      </div>
      <!-- 700 -->
      <div class="main">
        <!-- 701 -->
        <div class="chat-section">
          <!-- 702 -->
          <div class="chat-controls">
            <!-- 703 -->
            <button class="chat-btn" id="clearChat" data-tr="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
            <!-- 704 -->
            <button class="chat-btn" id="exportChat" data-tr="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É</button>
            <!-- 705 -->
          </div>
          <!-- 706 -->
          <div class="chat-window" id="chat"></div>
          <!-- 707 -->
          <div class="input-area">
            <!-- 708 -->
            <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç..." list="suggestions">
            <!-- 709 -->
            <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
            <!-- 710 -->
          </div>
          <!-- 711 -->
        </div>
        <!-- 712 -->
        <div class="doctors-section" id="doctorsSection">
          <!-- 713 -->
          <div class="search-box">
            <!-- 714 -->
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –≤—Ä–∞—á–∞ –∏–ª–∏ —Å–∏–º–ø—Ç–æ–º–∞...">
            <!-- 715 -->
            <i class="fas fa-search"></i>
            <!-- 716 -->
          </div>
          <!-- 717 -->
          <div id="doctorsContainer"></div>
          <!-- 718 -->
        </div>
        <!-- 719 -->
        <button class="doctors-toggle" id="doctorsToggle"><i class="fas fa-user-md"></i></button>
        <!-- 720 -->
      </div>
      <!-- 721 -->
    </div>
    <!-- Admin app -->
    <div id="adminApp" style="display:none; flex-direction:column; height:100%;">
      <!-- 723 -->
      <div class="header">
        <!-- 724 -->
        <div class="header-left">
          <!-- 725 -->
          <div class="logo" data-tr="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
          <!-- 726 -->
        </div>
        <!-- 727 -->
        <div class="header-right">
          <!-- 728 -->
          <span class="user-info" id="adminName">–ê–¥–º–∏–Ω</span>
          <!-- 729 -->
          <button class="settings-btn" id="adminSettingsBtn"><i class="fas fa-cog"></i></button>
          <!-- 730 -->
          <button class="logout" id="logoutAdmin" data-tr="–í—ã–π—Ç–∏">–í—ã–π—Ç–∏</button>
          <!-- 731 -->
        </div>
        <!-- 732 -->
      </div>
      <!-- 733 -->
      <div class="admin-panel">
        <!-- 734 -->
        <h2 data-tr="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
        <table id="usersTable">
          <!-- 736 -->
          <thead><tr><th>#</th><th>Email</th><th data-tr="–ò–º—è">–ò–º—è</th><th data-tr="–§–∞–º–∏–ª–∏—è">–§–∞–º–∏–ª–∏—è</th><th data-tr="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</th><th data-tr="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th><th data-tr="–†–æ–ª—å">–†–æ–ª—å</th></tr></thead>
          <!-- 737 -->
          <tbody></tbody>
          <!-- 738 -->
        </table>
        <!-- 739 -->
        <h2 style="margin-top:50px;" data-tr="–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤">–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤</h2>
        <!-- 740 -->
        <div id="topSymptoms"><p data-tr="–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p></div>
        <!-- 741 -->
        <h2 style="margin-top:50px;" data-tr="–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)">–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)</h2>
        <!-- 742 -->
        <table id="doctorsTable">
          <!-- 743 -->
          <thead><tr><th data-tr="–§–æ—Ç–æ">–§–æ—Ç–æ</th><th data-tr="–§–ò–û">–§–ò–û</th><th data-tr="–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</th><th data-tr="–†–µ–π—Ç–∏–Ω–≥">–†–µ–π—Ç–∏–Ω–≥</th><th data-tr="–ö–ª–∏–Ω–∏–∫–∞">–ö–ª–∏–Ω–∏–∫–∞</th><th data-tr="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</th></tr></thead>
          <!-- 744 -->
          <tbody></tbody>
          <!-- 745 -->
        </table>
        <!-- 746 -->
        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–µ–∫—Ü–∏—è –∑–∞—è–≤–æ–∫ (renderAdminPanel –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—ë –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
      </div>
      <!-- 747 -->
    </div>
    <!-- 748 -->
  </div>
  <!-- Settings modal -->
  <div class="modal" id="settingsModal">
    <!-- 750 -->
    <div class="modal-content">
      <!-- 751 -->
      <h3 data-tr="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
      <!-- 752 -->
      <div class="settings-section">
        <!-- 754 -->
        <h4 data-tr="–Ø–∑—ã–∫">–Ø–∑—ã–∫</h4>
        <!-- 755 -->
        <div class="language-selector">
          <!-- 756 -->
          <span class="lang-flag active" data-lang="ru">üá∑üá∫</span>
          <!-- 757 -->
          <span class="lang-flag" data-lang="en">üá∫üá∏</span>
          <!-- 758 -->
          <span class="lang-flag" data-lang="tj">üáπüáØ</span>
          <!-- 759 -->
        </div>
        <!-- 760 -->
      </div>
      <div class="settings-section">
        <!-- 762 -->
        <h4 data-tr="–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è">–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h4>
        <!-- 763 -->
        <div class="bg-options">
          <!-- 764 -->
          <div class="bg-option active" data-bg="linear-gradient(135deg, #1b38bb 0%, #1249c0 100%)"></div>
          <!-- 765 -->
          <div class="bg-option" data-bg="linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"></div>
          <!-- 766 -->
          <div class="bg-option" data-bg="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"></div>
          <!-- 767 -->
          <div class="bg-option" data-bg="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"></div>
          <!-- 768 -->
          <div class="bg-option" data-bg="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"></div>
          <!-- 769 -->
          <div class="bg-option" data-bg="url('https://images.unsplash.com/photo-1557682257-2f9c36a3a7e9?auto=format&fit=crop&w=1200&q=80') center/cover no-repeat"></div>
          <!-- 770 -->
        </div>
        <!-- 771 -->
      </div>
      <div class="settings-section">
        <!-- 773 -->
        <h4 data-tr="–í–∞—à –∞–≤–∞—Ç–∞—Ä">–í–∞—à –∞–≤–∞—Ç–∞—Ä</h4>
        <!-- 774 -->
        <img class="current-avatar-preview" id="currentAvatarPreview" src="https://randomuser.me/api/portraits/men/1.jpg">
        <!-- 775 -->
        <div class="avatar-options">
          <!-- 776 -->
          <div class="avatar-option active" data-avatar="https://randomuser.me/api/portraits/men/1.jpg"></div>
          <!-- 777 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/women/1.jpg"></div>
          <!-- 778 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/men/2.jpg"></div>
          <!-- 779 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/women/2.jpg"></div>
          <!-- 780 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/men/3.jpg"></div>
          <!-- 781 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/women/3.jpg"></div>
          <!-- 782 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/men/4.jpg"></div>
          <!-- 783 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/women/4.jpg"></div>
          <!-- 784 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/men/5.jpg"></div>
          <!-- 785 -->
          <div class="avatar-option" data-avatar="https://randomuser.me/api/portraits/women/5.jpg"></div>
          <!-- 786 -->
        </div>
        <!-- 787 -->
      </div>
      <div class="modal-buttons">
        <!-- 789 -->
        <button class="modal-btn" onclick="document.getElementById('settingsModal').classList.remove('open')" data-tr="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
        <!-- 790 -->
      </div>
      <!-- 791 -->
    </div>
    <!-- 792 -->
  </div>
  <!-- Book appointment modal -->
  <div class="modal" id="bookModal">
    <!-- 794 -->
    <div class="modal-content">
      <!-- 795 -->
      <h3 data-tr="–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º">–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º</h3>
      <!-- 796 -->
      <p id="bookDoctorName" style="margin-bottom:20px;font-weight:bold;font-size:18px;"></p>
      <!-- 797 -->
      <div class="book-form">
        <!-- 798 -->
        <label data-tr="–î–∞—Ç–∞:">–î–∞—Ç–∞:</label>
        <!-- 799 -->
        <input type="date" id="bookDate" required>
        <!-- 800 -->
        <label data-tr="–í—Ä–µ–º—è:">–í—Ä–µ–º—è:</label>
        <!-- 801 -->
        <input type="time" id="bookTime" required>
        <!-- 802 -->
        <label data-tr="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):</label>
        <!-- 803 -->
        <textarea id="bookComment" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã –ø–æ–¥—Ä–æ–±–Ω–µ–µ..." rows="4"></textarea>
        <!-- 804 -->
      </div>
      <!-- 805 -->
      <div class="modal-buttons">
        <!-- 806 -->
        <button class="modal-btn secondary" onclick="document.getElementById('bookModal').classList.remove('open')" data-tr="–û—Ç–º–µ–Ω–∞">–û—Ç–º–µ–Ω–∞</button>
        <!-- 807 -->
        <button class="modal-btn" id="submitBook" data-tr="–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        <!-- 808 -->
      </div>
      <!-- 809 -->
    </div>
    <!-- 810 -->
  </div>
  <!-- Suggestions -->
  <datalist id="suggestions">
    <!-- 812 -->
    <option value="–ë–æ–ª–∏—Ç —Å–µ—Ä–¥—Ü–µ">
    <!-- 813 -->
    <option value="–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å, –º–∏–≥—Ä–µ–Ω—å">
    <!-- 814 -->
    <option value="–ë–æ–ª–∏—Ç –∂–∏–≤–æ—Ç, —Ç–æ—à–Ω–æ—Ç–∞">
    <!-- 815 -->
    <option value="–ö–∞—à–µ–ª—å, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞">
    <!-- 816 -->
    <option value="–ë–æ–ª–∏—Ç —É—Ö–æ –∏–ª–∏ –≥–æ—Ä–ª–æ">
    <!-- 817 -->
    <option value="–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–∂–µ–π">
    <!-- 818 -->
    <option value="–ë–æ–ª–∏—Ç –∑—É–±">
    <!-- 819 -->
    <option value="–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å, –∂–µ–Ω—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ">
    <!-- 820 -->
    <option value="–ü—Ä–æ–±–ª–µ–º—ã —Å–æ –∑—Ä–µ–Ω–∏–µ–º">
    <!-- 821 -->
    <option value="–†–µ–±—ë–Ω–æ–∫ –±–æ–ª–µ–µ—Ç">
    <!-- 822 -->
  </datalist>
  <!-- Sound -->
  <audio id="notificationSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3" preload="auto"></audio>
  <!-- 824 -->
  <!-- JavaScript -->
  <script>
    // 826 -->
    // Translations
    const translations = {
      ru: {
        "SmartDoctor": "SmartDoctor",
        "–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é<br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ": "–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é<br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ",
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
        "–í–æ–π—Ç–∏": "–í–æ–π—Ç–∏",
        "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
        "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç": "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç",
        "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
        "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏": "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏",
        "–í—ã–π—Ç–∏": "–í—ã–π—Ç–∏",
        "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç": "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç",
        "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É",
        "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å": "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å",
        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã",
        "–ò–º—è": "–ò–º—è",
        "–§–∞–º–∏–ª–∏—è": "–§–∞–º–∏–ª–∏—è",
        "–¢–µ–ª–µ—Ñ–æ–Ω": "–¢–µ–ª–µ—Ñ–æ–Ω",
        "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ": "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",
        "–†–æ–ª—å": "–†–æ–ª—å",
        "–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤": "–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤",
        "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...": "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...",
        "–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)": "–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)",
        "–§–æ—Ç–æ": "–§–æ—Ç–æ",
        "–§–ò–û": "–§–ò–û",
        "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å": "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å",
        "–†–µ–π—Ç–∏–Ω–≥": "–†–µ–π—Ç–∏–Ω–≥",
        "–ö–ª–∏–Ω–∏–∫–∞": "–ö–ª–∏–Ω–∏–∫–∞",
        "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
        "–Ø–∑—ã–∫": "–Ø–∑—ã–∫",
        "–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è",
        "–í–∞—à –∞–≤–∞—Ç–∞—Ä": "–í–∞—à –∞–≤–∞—Ç–∞—Ä",
        "–ó–∞–∫—Ä—ã—Ç—å": "–ó–∞–∫—Ä—ã—Ç—å",
        "–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º": "–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º",
        "–î–∞—Ç–∞:": "–î–∞—Ç–∞:",
        "–í—Ä–µ–º—è:": "–í—Ä–µ–º—è:",
        "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):",
        "–û—Ç–º–µ–Ω–∞": "–û—Ç–º–µ–Ω–∞",
        "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
      },
      en: {
        "SmartDoctor": "SmartDoctor",
        "–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é<br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ": "Your smart health assistant<br>Always here when you need",
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å": "Welcome",
        "–í–æ–π—Ç–∏": "Log in",
        "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "No account? Register",
        "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç": "Create account",
        "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "Register",
        "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏": "Already have an account? Log in",
        "–í—ã–π—Ç–∏": "Log out",
        "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç": "Clear chat",
        "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É": "Save conversation",
        "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å": "Admin Panel",
        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã": "System Users",
        "–ò–º—è": "First Name",
        "–§–∞–º–∏–ª–∏—è": "Last Name",
        "–¢–µ–ª–µ—Ñ–æ–Ω": "Phone",
        "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ": "Device",
        "–†–æ–ª—å": "Role",
        "–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤": "Top 5 Popular Symptoms",
        "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...": "Loading statistics...",
        "–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)": "Doctors in system (10)",
        "–§–æ—Ç–æ": "Photo",
        "–§–ò–û": "Full Name",
        "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å": "Specialty",
        "–†–µ–π—Ç–∏–Ω–≥": "Rating",
        "–ö–ª–∏–Ω–∏–∫–∞": "Clinic",
        "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "App Settings",
        "–Ø–∑—ã–∫": "Language",
        "–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "App Background",
        "–í–∞—à –∞–≤–∞—Ç–∞—Ä": "Your Avatar",
        "–ó–∞–∫—Ä—ã—Ç—å": "Close",
        "–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º": "Book Appointment",
        "–î–∞—Ç–∞:": "Date:",
        "–í—Ä–µ–º—è:": "Time:",
        "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):": "Comment (optional):",
        "–û—Ç–º–µ–Ω–∞": "Cancel",
        "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É": "Submit request"
      },
      tj: {
        "SmartDoctor": "SmartDoctor",
        "–í–∞—à —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –∑–¥–æ—Ä–æ–≤—å—é<br>–í—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ": "–Å—Ä–¥–∞–º—á–∏–∏ “≥—É—à–º–∞–Ω–¥–∏ —à—É–º–æ –¥–∞—Ä —Å–æ“≥–∞–∏ —Å–∞–ª–æ–º–∞—Ç”£<br>“≤–∞–º–µ—à–∞ –¥–∞—Ä –ø–∞“≥–ª”Ø—è—Ç–æ–Ω",
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å": "–•—É—à –æ–º–∞–¥–µ–¥",
        "–í–æ–π—Ç–∏": "–î–∞—Ä–æ–º–∞–¥–∞–Ω",
        "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "“≤–∏—Å–æ–± –Ω–∞–¥–æ—Ä–µ–¥? –ë–∞“õ–∞–π–¥–≥–∏—Ä”£",
        "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç": "“≤–∏—Å–æ–± —ç“∑–æ–¥ –∫—É–Ω–µ–¥",
        "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è": "–ë–∞“õ–∞–π–¥–≥–∏—Ä”£",
        "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏": "–ê–ª–ª–∞–∫–∞–π “≥–∏—Å–æ–± –¥–æ—Ä–µ–¥? –î–∞—Ä–æ–º–∞–¥–∞–Ω",
        "–í—ã–π—Ç–∏": "–ë–∞—Ä–æ–º–∞–¥–∞–Ω",
        "–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç": "–ß–∞—Ç—Ä–æ —Ç–æ–∑–∞ –∫–∞—Ä–¥–∞–Ω",
        "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É": "–°—É“≥–±–∞—Ç—Ä–æ –Ω–∏–≥–æ“≥ –¥–æ—à—Ç–∞–Ω",
        "–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å": "–ü–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã": "–ò—Å—Ç–∏—Ñ–æ–¥–∞–±–∞—Ä–∞–Ω–¥–∞–≥–æ–Ω–∏ —Å–∏—Å—Ç–µ–º–∞",
        "–ò–º—è": "–ù–æ–º",
        "–§–∞–º–∏–ª–∏—è": "–ù–∞—Å–∞–±",
        "–¢–µ–ª–µ—Ñ–æ–Ω": "–¢–µ–ª–µ—Ñ–æ–Ω",
        "–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ": "–î–∞—Å—Ç–≥–æ“≥",
        "–†–æ–ª—å": "–ù–∞“õ—à",
        "–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤": "–¢–æ–ø-5 –∞–ª–æ–º–∞—Ç“≥–æ–∏ –º–∞—ä–º—É–ª",
        "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...": "–ë–æ—Ä–≥–∏—Ä–∏–∏ –æ–º”Ø—Ä...",
        "–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)": "–¢–∞–±–∏–±–æ–Ω –¥–∞—Ä —Å–∏—Å—Ç–µ–º–∞ (10)",
        "–§–æ—Ç–æ": "–ê–∫—Å",
        "–§–ò–û": "–ù–æ–º—É –Ω–∞—Å–∞–±",
        "–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å": "–ò—Ö—Ç–∏—Å–æ—Å",
        "–†–µ–π—Ç–∏–Ω–≥": "–†–µ–π—Ç–∏–Ω–≥",
        "–ö–ª–∏–Ω–∏–∫–∞": "–ö–ª–∏–Ω–∏–∫–∞",
        "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "–¢–∞–Ω–∑–∏–º–æ—Ç“≥–æ–∏ –±–∞—Ä–Ω–æ–º–∞",
        "–Ø–∑—ã–∫": "–ó–∞–±–æ–Ω",
        "–§–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è": "–§–æ–Ω–∏ –±–∞—Ä–Ω–æ–º–∞",
        "–í–∞—à –∞–≤–∞—Ç–∞—Ä": "–ê–≤–∞—Ç–∞—Ä–∞—Ç–æ–Ω",
        "–ó–∞–∫—Ä—ã—Ç—å": "–ü”Ø—à–∏–¥–∞–Ω",
        "–ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º": "–°–∞–±—Ç–∏ “õ–∞–±—É–ª",
        "–î–∞—Ç–∞:": "–°–∞–Ω–∞:",
        "–í—Ä–µ–º—è:": "–í–∞“õ—Ç:",
        "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø–æ –∂–µ–ª–∞–Ω–∏—é):": "–®–∞—Ä“≥ (–∏—Ö—Ç–∏—ë—Ä”£):",
        "–û—Ç–º–µ–Ω–∞": "–ë–µ–∫–æ—Ä –∫–∞—Ä–¥–∞–Ω",
        "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É": "–§–∏—Ä–∏—Å—Ç–æ–¥–∞–Ω–∏ –¥–∞—Ä—Ö–æ—Å—Ç"
      }
    };
    let currentLang = localStorage.getItem('sd_lang') || 'ru';
    function translate() {
      document.querySelectorAll('[data-tr]').forEach(el => {
        const key = el.getAttribute('data-tr');
        if (translations[currentLang][key]) {
          el.innerHTML = translations[currentLang][key];
        }
      });
      document.documentElement.lang = currentLang;
    }
    document.querySelectorAll('.lang-flag').forEach(flag => {
      flag.onclick = () => {
        currentLang = flag.dataset.lang;
        localStorage.setItem('sd_lang', currentLang);
        document.querySelectorAll('.lang-flag').forEach(f => f.classList.toggle('active', f.dataset.lang === currentLang));
        translate();
      };
      if (flag.dataset.lang === currentLang) flag.classList.add('active');
    });
    const doctors = [
      {name:"–î—Ä. –ê–ª–∏—à–µ—Ä –ö–∞—Ä–∏–º–æ–≤", spec:"–¢–µ—Ä–∞–ø–µ–≤—Ç", rating:4.9, clinic:"–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞", address:"—É–ª. –†—É–¥–∞–∫–∏ 12", phone:"+992 90 123 45 67", photo:"https://randomuser.me/api/portraits/men/32.jpg"},
      {name:"–î—Ä. –ú–∞–¥–∏–Ω–∞ –Æ—Å—É—Ñ–æ–≤–∞", spec:"–õ–û–†-–≤—Ä–∞—á", rating:5.0, clinic:"–ú–¶ –°–æ–º–æ–Ω", address:"–ø—Ä. –°–æ–º–æ–Ω–∏ 23", phone:"+992 90 987 65 43", photo:"https://randomuser.me/api/portraits/women/44.jpg"},
      {name:"–î—Ä. –°–æ—Ö–∏–± –¢–æ—à–µ–≤", spec:"–ù–µ–≤—Ä–æ–ª–æ–≥", rating:4.8, clinic:"–ö–ª–∏–Ω–∏–∫–∞ –®–∏—Ñ–æ", address:"—É–ª. –ê–π–Ω–∏ 45", phone:"+992 90 456 78 90", photo:"https://randomuser.me/api/portraits/men/65.jpg"},
      {name:"–î—Ä. –õ–æ–ª–∞ –ì–∞–¥–æ–µ–≤–∞", spec:"–ì–∞—Å—Ç—Ä–æ—ç–Ω—Ç–µ—Ä–æ–ª–æ–≥", rating:4.9, clinic:"–¶–µ–Ω—Ç—Ä –∑–¥–æ—Ä–æ–≤—å—è", address:"—É–ª. –§–∏—Ä–¥–æ—É—Å–∏ 7", phone:"+992 90 765 43 21", photo:"https://randomuser.me/api/portraits/women/22.jpg"},
      {name:"–î—Ä. –§–∞—Ä–∏–¥ –ù–∞–∑–∞—Ä–æ–≤", spec:"–ö–∞—Ä–¥–∏–æ–ª–æ–≥", rating:5.0, clinic:"–ú–¶ –°–æ–º–æ–Ω", address:"–ø—Ä. –°–æ–º–æ–Ω–∏ 23", phone:"+992 00 666 82 19", photo:"https://randomuser.me/api/portraits/men/33.jpg"},
      {name:"–î—Ä. –ó–∞—Ä–∏–Ω–∞ –ê–±–¥—É–ª–ª–æ–µ–≤–∞", spec:"–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥", rating:4.9, clinic:"–ö–ª–∏–Ω–∏–∫–∞ –ö—Ä–∞—Å–æ—Ç—ã", address:"—É–ª. –î–µ—Ö–æ—Ç–∏ 89", phone:"+992 98 765 43 21", photo:"https://randomuser.me/api/portraits/women/68.jpg"},
      {name:"–î—Ä. –†—É—Å—Ç–∞–º –•–æ–¥–∂–∏–µ–≤", spec:"–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥", rating:4.8, clinic:"Dental Lux", address:"—É–ª. –ë–æ—Ö—Ç–∞—Ä 15", phone:"+992 88 123 45 67", photo:"https://randomuser.me/api/portraits/men/76.jpg"},
      {name:"–î—Ä. –§–æ—Ç–∏–º–∞ –•–∏–º–∞—Ç–æ–≤–∞", spec:"–†–µ–∞–Ω–∏–º–∞—Ç–æ–ª–æ–≥", rating:5.0, clinic:"–ö–ª–∏–Ω–∏–∫–∞ –ñ–∞—Å–º–∏–Ω", address:"—É–ª –ú–∏—Ä–∑–æ –¢—É—Ä—Å—É–Ω–∑–æ–¥–∞ 13/23", phone:"+992 00 355 38 38", photo:"https://randomuser.me/api/portraits/women/55.jpg"},
      {name:"–î—Ä. –î–∏–ª—à–æ–¥ –ú–∏—Ä–∑–æ–µ–≤", spec:"–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥", rating:4.9, clinic:"–ì–ª–∞–∑–Ω–∞—è –∫–ª–∏–Ω–∏–∫–∞", address:"—É–ª. –®–µ–≤—á–µ–Ω–∫–æ 21", phone:"+992 91 777 22 33", photo:"https://randomuser.me/api/portraits/men/41.jpg"},
      {name:"–î—Ä. –ü–∞—Ä–≤–∏–Ω–∞ –®–∞—Ä–∏–ø–æ–≤–∞", spec:"–ü–µ–¥–∏–∞—Ç—Ä", rating:5.0, clinic:"–î–µ—Ç—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä", address:"—É–ª. –†–∞—Å—É–ª–æ–≤ 10", phone:"+992 90 700 11 22", photo:"https://randomuser.me/api/portraits/women/33.jpg"}
    ];
    let users = JSON.parse(localStorage.getItem("sd_users")) || [
      {email:"admin@smartdoctor.tj", password:"admin123", firstName:"–ê–¥–º–∏–Ω", lastName:"–°–∏—Å—Ç–µ–º—ã", phone:"", role:"admin", device:"PC", avatar:"https://randomuser.me/api/portraits/men/1.jpg"}
    ];
    let currentUser = null;
    let chatHistory = [];
    let symptomStats = JSON.parse(localStorage.getItem("sd_symptoms") || "{}");
    // appointments will be loaded from localStorage or empty array
    let appointments = JSON.parse(localStorage.getItem("sd_appointments") || "[]");

    // –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Android/iPhone)
    const isMobile = /Android|iPhone|iPad|iPod/.test(navigator.userAgent) || /Mobi/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);

    const notificationSound = document.getElementById('notificationSound');
    if ('Notification' in window && Notification.permission === "default") {
      Notification.requestPermission();
    }
    function playSound() {
      notificationSound.currentTime = 0;
      notificationSound.play().catch(() => {});
    }
    function showNotification(title, body) {
      if (Notification.permission === "granted") {
        new Notification(title, { body });
      }
    }
    function applyBackground(bg) {
      document.body.style.setProperty('--bg', bg);
      localStorage.setItem('sd_background', bg);
    }
    function applyAvatar(url) {
      document.getElementById('userAvatar').src = url;
      document.getElementById('currentAvatarPreview').src = url;
      if (currentUser) {
        currentUser.avatar = url;
        localStorage.setItem("sd_current", JSON.stringify(currentUser));
        const idx = users.findIndex(u => u.email === currentUser.email);
        if (idx !== -1) users[idx].avatar = url;
        localStorage.setItem("sd_users", JSON.stringify(users));
      }
    }
    const settingsModal = document.getElementById('settingsModal');
    const bookModal = document.getElementById('bookModal');
    document.getElementById('settingsBtn')?.addEventListener('click', () => {
      document.getElementById('currentAvatarPreview').src = document.getElementById('userAvatar').src;
      settingsModal.classList.add('open');
    });
    document.getElementById('adminSettingsBtn')?.addEventListener('click', () => settingsModal.classList.add('open'));
    document.querySelectorAll('.modal').forEach(m => m.onclick = e => { if (e.target === m) m.classList.remove('open'); });
    document.querySelectorAll('.bg-option').forEach(o => o.onclick = () => {
      applyBackground(o.dataset.bg);
      document.querySelectorAll('.bg-option').forEach(x => x.classList.toggle('active', x === o));
    });
    document.querySelectorAll('.avatar-option').forEach(o => o.onclick = () => {
      applyAvatar(o.dataset.avatar);
      document.querySelectorAll('.avatar-option').forEach(x => x.classList.toggle('active', x === o));
    });
    let currentDoctor = null;
    function openBookModal(doc) {
      currentDoctor = doc;
      document.getElementById('bookDoctorName').textContent = `–ó–∞–ø–∏—Å—å –∫: ${doc.name} (${doc.spec})`;
      bookModal.classList.add('open');
    }
    document.getElementById('submitBook').onclick = () => {
      const date = document.getElementById('bookDate').value;
      const time = document.getElementById('bookTime').value;
      const comment = document.getElementById('bookComment').value.trim();
      if (!date || !time) return alert("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è");
      const appointment = {id: Date.now(), doctor: currentDoctor.name, date, time, comment, user: currentUser.email, status: "–ù–æ–≤–∞—è", adminResponse: ""};
      appointments.push(appointment);
      localStorage.setItem("sd_appointments", JSON.stringify(appointments));
      addMessage(`‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!<br>–í—Ä–∞—á: ${currentDoctor.name}<br>–î–∞—Ç–∞: ${date}<br>–í—Ä–µ–º—è: ${time}<br>${comment ? '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ' + comment : ''}<br><br>–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è! ‚ù§Ô∏è`, "ai");
      playSound();
      showNotification("SmartDoctor", "–ó–∞—è–≤–∫–∞ –Ω–∞ –ø—Ä–∏—ë–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
      bookModal.classList.remove('open');
      document.getElementById('bookDate').value = '';
      document.getElementById('bookTime').value = '';
      document.getElementById('bookComment').value = '';
    };
    const authScreen = document.getElementById('authScreen');
    const patientApp = document.getElementById('patientApp');
    const adminApp = document.getElementById('adminApp');
    const chat = document.getElementById('chat');
    const doctorsSection = document.getElementById('doctorsSection');
    const doctorsToggle = document.getElementById('doctorsToggle');
    doctorsToggle.onclick = () => doctorsSection.classList.toggle('open');
    document.addEventListener('click', (e) => {
      if (!doctorsSection.contains(e.target) && !doctorsToggle.contains(e.target) && doctorsSection.classList.contains('open')) {
        doctorsSection.classList.remove('open');
      }
    });
    let isLoginMode = true;
    document.getElementById('toggleLink').onclick = () => {
      isLoginMode = !isLoginMode;
      ['firstName','lastName','phone'].forEach(id => document.getElementById(id).style.display = isLoginMode ? 'none' : 'block');
      document.getElementById('authTitle').textContent = isLoginMode ? translations[currentLang]["–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å"] : translations[currentLang]["–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç"];
      document.getElementById('authBtn').textContent = isLoginMode ? translations[currentLang]["–í–æ–π—Ç–∏"] : translations[currentLang]["–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"];
      document.getElementById('toggleLink').textContent = isLoginMode ? translations[currentLang]["–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"] : translations[currentLang]["–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏"];
    };
    document.getElementById('authBtn').onclick = () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");
      if (isLoginMode) {
        const user = users.find(u => u.email === email && u.password === password);
        if (user) {
          currentUser = user;
          localStorage.setItem("sd_current", JSON.stringify(user));
          showMainApp();
        } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
      } else {
        const f = document.getElementById('firstName').value.trim();
        const l = document.getElementById('lastName').value.trim();
        const p = document.getElementById('phone').value.trim();
        if (!f || !l || !p) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
        if (users.some(u => u.email === email)) return alert("–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        let device = "PC";
        if (isAndroid) device = "Android";
        else if (isIOS) device = "iPhone/iPad";
        else if (isMobile) device = "Mobile";
        const newUser = {email, password, firstName: f, lastName: l, phone: p, role: "patient", device, avatar:"https://randomuser.me/api/portraits/men/1.jpg"};
        users.push(newUser);
        localStorage.setItem("sd_users", JSON.stringify(users));
        alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ");
        document.getElementById('toggleLink').click();
      }
    };
    function showMainApp() {
      authScreen.style.display = 'none';
      chatHistory = JSON.parse(localStorage.getItem(`sd_chat_${currentUser.email}`) || "[]");
      chat.innerHTML = '';
      chatHistory.forEach(m => addMessage(m.text, m.sender, false));
      document.getElementById('userAvatar').src = currentUser.avatar || "https://randomuser.me/api/portraits/men/1.jpg";
      if (currentUser.role === "admin") {
        adminApp.style.display = 'flex';
        document.getElementById('adminName').textContent = currentUser.firstName;
        renderAdminPanel();
      } else {
        patientApp.style.display = 'flex';
        document.getElementById('userName').textContent = currentUser.firstName + " " + currentUser.lastName;
        if (chatHistory.length === 0) {
          addMessage(`–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${currentUser.firstName}! ‚ù§Ô∏è<br>–Ø –≤–∞—à —É–º–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫.<br><br>–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç ‚Äî –ø–æ–¥–±–µ—Ä—É –ª—É—á—à–µ–≥–æ –≤—Ä–∞—á–∞ –∑–∞ 10 —Å–µ–∫—É–Ω–¥!`, "ai");
        }
        renderDoctors(doctors);
      }
    }
    document.querySelectorAll('.logout').forEach(btn => btn.onclick = () => { localStorage.removeItem("sd_current"); location.reload(); });
    function addMessage(text, sender, save = true) {
      const div = document.createElement('div');
      div.className = `message ${sender}`;
      div.innerHTML = text;
      chat.appendChild(div);
      chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
      if (sender === 'ai') {
        playSound();
        showNotification("SmartDoctor", "–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–º–æ—â–Ω–∏–∫–∞");
      }
      if (save && currentUser) {
        chatHistory.push({text, sender});
        localStorage.setItem(`sd_chat_${currentUser.email}`, JSON.stringify(chatHistory));
      }
    }
    function showTyping() {
      const typing = document.createElement('div');
      typing.className = 'typing-indicator';
      typing.innerHTML = '–ü–µ—á–∞—Ç–∞–µ—Ç<span class="dots">...</span>';
      typing.id = 'typingIndicator';
      chat.appendChild(typing);
      chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
    }
    function hideTyping() {
      const indicator = document.getElementById('typingIndicator');
      if (indicator) indicator.remove();
    }
    const empathy = [
      "–ü–æ–Ω–∏–º–∞—é, –∫–∞–∫ —ç—Ç–æ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ...",
      "–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π—Ç–µ, —Å–µ–π—á–∞—Å –ø–æ–º–æ–≥—É!",
      "–ñ–∞–ª—å, —á—Ç–æ –≤—ã –ø–ª–æ—Ö–æ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ...",
      "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞–ª–∏ ‚ù§Ô∏è",
      "–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤–º–µ—Å—Ç–µ",
      "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å ‚ù§Ô∏è"
    ];
    const proverbs = [
      "–ó–¥–æ—Ä–æ–≤—å–µ ‚Äî —Å–∞–º–æ–µ –¥–æ—Ä–æ–≥–æ–µ –±–æ–≥–∞—Ç—Å—Ç–≤–æ",
      "–í –∑–¥–æ—Ä–æ–≤–æ–º —Ç–µ–ª–µ ‚Äî –∑–¥–æ—Ä–æ–≤—ã–π –¥—É—Ö",
      "–ë–µ—Ä–µ–≥–∏ –∑–¥–æ—Ä–æ–≤—å–µ —Å–º–æ–ª–æ–¥—É",
      "–ë–æ–ª–µ–∑–Ω—å –ª–µ–≥—á–µ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å, —á–µ–º –ª–µ—á–∏—Ç—å",
      "–î–≤–∏–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å",
      "–°–º–µ—Ö ‚Äî –ª—É—á—à–µ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ",
      "–Ø–±–ª–æ–∫–æ –≤ –¥–µ–Ω—å ‚Äî –∏ –≤—Ä–∞—á –Ω–µ –Ω—É–∂–µ–Ω"
    ];
    const tips = [
      "–ü–µ–π—Ç–µ 1,5‚Äì2 –ª–∏—Ç—Ä–∞ –≤–æ–¥—ã –≤ –¥–µ–Ω—å",
      "–ì—É–ª—è–π—Ç–µ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ 30 –º–∏–Ω—É—Ç",
      "–°–ø–∏—Ç–µ 7‚Äì8 —á–∞—Å–æ–≤ ‚Äî —ç—Ç–æ –ª—É—á—à–µ–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ",
      "–ï—à—å—Ç–µ –±–æ–ª—å—à–µ –æ–≤–æ—â–µ–π –∏ —Ñ—Ä—É–∫—Ç–æ–≤",
      "–£–ª—ã–±–∞–π—Ç–µ—Å—å —á–∞—â–µ ‚Äî —ç—Ç–æ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç",
      "–î–µ–ª–∞–π—Ç–µ –∑–∞—Ä—è–¥–∫—É –ø–æ —É—Ç—Ä–∞–º"
    ];
    function getRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }
    function getDoctorResponse(query) {
      let response = getRandom(empathy) + " ‚ù§Ô∏è<br><br>";
      const q = query.toLowerCase();
      let specialist = null;
      const map = {
        "—Å–µ—Ä–¥—Ü–µ –¥–∞–≤–ª–µ–Ω–∏–µ –ø—É–ª—å—Å –≥—Ä—É–¥—å –∫–∞—Ä–¥–∏–æ": "–ö–∞—Ä–¥–∏–æ–ª–æ–≥",
        "–∂–∏–≤–æ—Ç –∂–µ–ª—É–¥–æ–∫ —Ç–æ—à–Ω–æ—Ç–∞ —Ä–≤–æ—Ç–∞ –ø–æ–Ω–æ—Å": "–ì–∞—Å—Ç—Ä–æ—ç–Ω—Ç–µ—Ä–æ–ª–æ–≥",
        "–≥–æ–ª–æ–≤–∞ –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –º–∏–≥—Ä–µ–Ω—å –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ": "–ù–µ–≤—Ä–æ–ª–æ–≥",
        "—É—Ö–æ –≥–æ—Ä–ª–æ –Ω–æ—Å –∫–∞—à–µ–ª—å –Ω–∞—Å–º–æ—Ä–∫ –ª–æ—Ä": "–õ–û–†-–≤—Ä–∞—á",
        "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–∞—à–µ–ª—å —Å–ª–∞–±–æ—Å—Ç—å –ø—Ä–æ—Å—Ç—É–¥–∞ –≥—Ä–∏–ø–ø": "–¢–µ—Ä–∞–ø–µ–≤—Ç",
        "–∫–æ–∂–∞ —Å—ã–ø—å –∑—É–¥ –∞–ª–ª–µ—Ä–≥–∏—è": "–î–µ—Ä–º–∞—Ç–æ–ª–æ–≥",
        "–∑—É–± –∑—É–±—ã": "–°—Ç–æ–º–∞—Ç–æ–ª–æ–≥",
        "—Ç–µ–∂–µ–ª—ã–µ —Ç—Ä–∞–≤–º—ã —Ç–µ–∂–µ–ª—ã–µ –æ–ø–∏—Ä–∞—Ü–∏–∏ –†–µ–∞–Ω–∏–º–∞—Ç–æ–ª–æ–≥": "–†–µ–∞–Ω–∏–º–∞—Ç–æ–ª–æ–≥",
        "–≥–ª–∞–∑–∞ –∑—Ä–µ–Ω–∏–µ": "–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥",
        "—Ä–µ–±—ë–Ω–æ–∫ –º–∞–ª—ã—à –¥–µ—Ç–∏ –ø–µ–¥–∏–∞—Ç—Ä": "–ü–µ–¥–∏–∞—Ç—Ä"
      };
      for (let keys in map) {
        if (keys.split(' ').some(k => q.includes(k))) {
          specialist = map[keys];
          break;
        }
      }
      if (specialist) {
        const found = doctors.filter(d => d.spec === specialist);
        response += `–†–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ <b>${specialist}</b>! ü©∫<br><br>`;
        if (found.length) {
          found.slice(0, 2).forEach(doc => {
            response += `
              <div style="background:#f0fffe;padding:16px;border-radius:16px;margin:14px 0;border-left:5px solid var(--primary);">
                <b>${doc.name}</b><br>${doc.spec} ‚òÖ ${doc.rating}<br>${doc.clinic}<br><b>–¢–µ–ª: ${doc.phone}</b><br>${doc.address}<br><br>
                <button class="book-btn" onclick="openBookModal(${JSON.stringify(doc).replace(/"/g, '&quot;')})">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º</button>
              </div>`;
          });
        }
        response += `<br><i>–¢–æ—á–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑ —Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ –≤—Ä–∞—á –ø–æ—Å–ª–µ –æ—Å–º–æ—Ç—Ä–∞.</i> ‚ö†Ô∏è`;
      } else {
        response += "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å–∏–º–ø—Ç–æ–º–∞—Ö ‚Äî –ø–æ–¥–±–µ—Ä—É –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–∞—á–∞! üòä";
      }
      response += `<br><br><div style="margin-top:20px;display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-start;">`;
      const quickReplies = [
        "–î–∞, –µ—Å—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ üî•",
        "–ù–µ—Ç –∞–ª–ª–µ—Ä–≥–∏–∏",
        "–ë–æ–ª–∏—Ç —É–∂–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π",
        "–ï—Å—Ç—å —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è",
        "–•–æ—á—É –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –≤—Ä–∞—á—É",
        "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ"
      ];
      quickReplies.forEach(reply => {
        response += `<button class="chat-btn" style="padding:10px 16px;font-size:14px;" onclick="quickSend('${reply}')">${reply}</button>`;
      });
      response += `</div>`;
      response += `<br><br>üí≠ <i>${getRandom(proverbs)}</i>`;
      response += `<br><br>ü©∫ <b>–°–æ–≤–µ—Ç –¥–Ω—è:</b> ${getRandom(tips)}`;
      response += `<br><br>–í—ã–∑–¥–æ—Ä–∞–≤–ª–∏–≤–∞–π—Ç–µ —Å–∫–æ—Ä–µ–µ! –û–±–Ω–∏–º–∞—é –∫—Ä–µ–ø–∫–æ ‚ù§Ô∏è`;
      return response;
    }
    function quickSend(text) {
      document.getElementById('messageInput').value = text;
      document.getElementById('sendBtn').click();
    }
    document.getElementById('sendBtn').onclick = () => {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, 'user');
      updateSymptomStats(text);
      input.value = '';
      showTyping();
      setTimeout(() => {
        hideTyping();
        addMessage(getDoctorResponse(text), 'ai');
      }, 1000 + Math.random() * 1000);
    };
    document.getElementById('messageInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') document.getElementById('sendBtn').click();
    });
    document.getElementById('clearChat')?.addEventListener('click', () => {
      if (confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –ø–µ—Ä–µ–ø–∏—Å–∫—É?")) {
        chatHistory = [];
        localStorage.removeItem(`sd_chat_${currentUser.email}`);
        chat.innerHTML = '';
        addMessage("–ß–∞—Ç –æ—á–∏—â–µ–Ω. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?", "ai", false);
      }
    });
    document.getElementById('exportChat')?.addEventListener('click', () => {
      const text = chatHistory.map(m => (m.sender === 'user' ? '–í—ã' : 'SmartDoctor') + ': ' + m.text.replace(/<br>/g, '\n')).join('\n\n');
      const blob = new Blob([text], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `SmartDoctor_—á–∞—Ç_${new Date().toLocaleDateString()}.txt`;
      a.click();
    });
    function updateSymptomStats(query) {
      const q = query.toLowerCase();
      symptomStats[q] = (symptomStats[q] || 0) + 1;
      localStorage.setItem("sd_symptoms", JSON.stringify(symptomStats));
    }
    function renderDoctors(list) {
      const container = document.getElementById('doctorsContainer');
      container.innerHTML = '';
      list.forEach(doc => {
        container.innerHTML += `
          <div class="doctor-card">
            <div class="doc-header">
              <img src="${doc.photo}" alt="${doc.name}">
              <div class="doc-info">
                <h3>${doc.name}</h3>
                <div class="specialty">${doc.spec}</div>
                <div class="rating">‚òÖ ${doc.rating}</div>
                <div><b>${doc.clinic}</b><br><small>${doc.address}</small></div>
              </div>
            </div>
            <div class="doc-footer">
              <div style="font-size:18px; margin-bottom:10px;">${doc.phone}</div>
              <a href="tel:${doc.phone}" class="call-btn">–ü–æ–∑–≤–æ–Ω–∏—Ç—å —Å–µ–π—á–∞—Å</a>
              <button class="book-btn" onclick="openBookModal(${JSON.stringify(doc).replace(/"/g, '&quot;')})">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
            </div>
          </div>`;
      });
    }
    document.getElementById('searchInput').oninput = e => {
      const q = e.target.value.toLowerCase();
      let filtered = doctors.filter(d =>
        d.name.toLowerCase().includes(q) ||
        d.spec.toLowerCase().includes(q) ||
        d.clinic.toLowerCase().includes(q)
      );
      renderDoctors(filtered.length ? filtered : doctors);
    };

    /* ===== –û–¢–†–ò–°–û–í–ö–ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò (—Å —Å–µ–∫—Ü–∏–µ–π –∑–∞—è–≤–æ–∫) ===== */
    function renderAdminPanel() {
      // –û—á–∏—â–∞–µ–º –ø–∞–Ω–µ–ª—å –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º
      document.querySelector('.admin-panel').innerHTML = `
        <h2 data-tr="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
        <table id="usersTable">
          <thead><tr><th>#</th><th>Email</th><th data-tr="–ò–º—è">–ò–º—è</th><th data-tr="–§–∞–º–∏–ª–∏—è">–§–∞–º–∏–ª–∏—è</th><th data-tr="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</th><th data-tr="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th><th data-tr="–†–æ–ª—å">–†–æ–ª—å</th></tr></thead>
          <tbody></tbody>
        </table>
        <h2 style="margin-top:50px;" data-tr="–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤">–¢–æ–ø-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤</h2>
        <div id="topSymptoms"><p data-tr="–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p></div>
        <h2 style="margin-top:50px;" data-tr="–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)">–í—Ä–∞—á–∏ –≤ —Å–∏—Å—Ç–µ–º–µ (10)</h2>
        <table id="doctorsTable">
          <thead><tr><th data-tr="–§–æ—Ç–æ">–§–æ—Ç–æ</th><th data-tr="–§–ò–û">–§–ò–û</th><th data-tr="–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</th><th data-tr="–†–µ–π—Ç–∏–Ω–≥">–†–µ–π—Ç–∏–Ω–≥</th><th data-tr="–ö–ª–∏–Ω–∏–∫–∞">–ö–ª–∏–Ω–∏–∫–∞</th><th data-tr="–¢–µ–ª–µ—Ñ–æ–Ω">–¢–µ–ª–µ—Ñ–æ–Ω</th></tr></thead>
          <tbody></tbody>
        </table>`;

      const ut = document.querySelector('#usersTable tbody');
      ut.innerHTML = users.map((u,i) => `
        <tr>
          <td>${i+1}</td>
          <td>${u.email}</td>
          <td>${u.firstName}</td>
          <td>${u.lastName}</td>
          <td>${u.phone}</td>
          <td>${u.device}</td>
          <td><span style="padding:6px 12px; background:${u.role==='admin'?'#ff4757':'#00d4c1'}; color:white; border-radius:8px;">${u.role === 'admin' ? '–ê–¥–º–∏–Ω' : '–ü–∞—Ü–∏–µ–Ω—Ç'}</span></td>
        </tr>
      `).join('');

      const sorted = Object.entries(symptomStats).sort((a,b) => b[1] - a[1]).slice(0,5);
      const topEl = document.getElementById('topSymptoms');
      topEl.innerHTML = sorted.length ? '<ul>' + sorted.map(([s,c]) => `<li><b>${s}</b> ‚Äî ${c} —Ä–∞–∑</li>`).join('') + '</ul>' : '<p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';

      document.querySelector('#doctorsTable tbody').innerHTML = doctors.map(d => `
        <tr>
          <td><img src="${d.photo}" width="60" style="border-radius:12px;"></td>
          <td><b>${d.name}</b></td>
          <td>${d.spec}</td>
          <td>‚òÖ ${d.rating}</td>
          <td>${d.clinic}</td>
          <td>${d.phone}</td>
        </tr>`).join('');

      // === –°–µ–∫—Ü–∏—è –∑–∞—è–≤–æ–∫ ===
      let appsHTML = `
        <h2 style="margin-top:50px;">–ó–∞—è–≤–∫–∏ –Ω–∞ –ø—Ä–∏—ë–º (${appointments.length})</h2>
        <table class="appointments-table">
          <thead>
            <tr>
              <th>#</th>
              <th>–ü–∞—Ü–∏–µ–Ω—Ç</th>
              <th>–í—Ä–∞—á</th>
              <th>–î–∞—Ç–∞</th>
              <th>–í—Ä–µ–º—è</th>
              <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–û—Ç–≤–µ—Ç</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody id="appointmentsTbody">`;

      if (appointments.length === 0) {
        appsHTML += `<tr><td colspan="9" style="text-align:center;padding:16px;background:#fff;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>`;
      } else {
        appointments.forEach((a, i) => {
          const patient = users.find(u => u.email === a.user);
          const patientName = patient ? `${patient.firstName} ${patient.lastName}` : a.user;
          const statusColor = a.status === "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ" ? "#4caf50" : a.status === "–û—Ç–∫–ª–æ–Ω–µ–Ω–æ" ? "#f44336" : "#ff9800";

          appsHTML += `
            <tr data-app-id="${a.id}">
              <td>${i+1}</td>
              <td><b>${patientName}</b><br><small>${a.user}<br>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${patient?.device || '‚Äî'}</small></td>
              <td>${a.doctor}</td>
              <td>${a.date}</td>
              <td>${a.time}</td>
              <td>${a.comment || '‚Äî'}</td>
              <td><span style="padding:6px 12px;border-radius:8px;background:${statusColor};color:white;">${a.status}</span></td>
              <td>${a.adminResponse || '‚Äî'}</td>
              <td>
                <button class="accept" onclick="adminRespond(${a.id},'–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button class="reject" onclick="adminRespond(${a.id},'–û—Ç–∫–ª–æ–Ω–µ–Ω–æ')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                <button class="accept" style="background:#6c7ae0;color:#fff;" onclick="adminCustomResponse(${a.id})">–ù–∞–ø–∏—Å–∞—Ç—å</button>
              </td>
            </tr>
          `;
        });
      }

      appsHTML += `</tbody></table>`;
      document.querySelector('.admin-panel').innerHTML += appsHTML;
    }

    /* ===== –§–£–ù–ö–¶–ò–ò –û–¢–í–ï–¢–ê –ê–î–ú–ò–ù–ê ‚Äî –ó–ê–Ø–í–ö–ê –ò–°–ß–ï–ó–ê–ï–¢ –ü–û–°–õ–ï –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø/–û–¢–ö–õ–û–ù–ï–ù–ò–Ø ===== */
    function adminRespond(id, status) {
      const msg = status === "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ"
        ? "üéâ –í–∞—à–∞ –∑–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞! –ñ–¥—ë–º –≤–∞—Å –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ —Å—é–¥–∞ ‚ù§Ô∏è"
        : "üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è!";
      // removeAfter = true ‚Äî –∑–∞—è–≤–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞
      sendAdminMessageToPatient(id, msg, status, true);
    }

    function adminCustomResponse(id) {
      const custom = prompt("–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç—É:");
      if (custom && custom.trim()) {
        sendAdminMessageToPatient(id, custom.trim(), "–í –æ–±—Ä–∞–±–æ—Ç–∫–µ", false);
      }
    }

    function sendAdminMessageToPatient(appId, message, status, removeAfter = false) {
      const appIndex = appointments.findIndex(a => a.id === appId);
      if (appIndex === -1) return;
      const app = appointments[appIndex];

      app.status = status;
      app.adminResponse = message;

      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞
      const patientChat = JSON.parse(localStorage.getItem(`sd_chat_${app.user}`) || "[]");
      patientChat.push({text: `‚úâÔ∏è <b>–û—Ç–≤–µ—Ç –æ—Ç –∫–ª–∏–Ω–∏–∫–∏:</b><br><br>${message}`, sender: "ai"});
      localStorage.setItem(`sd_chat_${app.user}`, JSON.stringify(patientChat));

      // –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –æ–Ω–ª–∞–π–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ä–∞–∑—É
      if (currentUser && currentUser.email === app.user) {
        addMessage(`‚úâÔ∏è <b>–û—Ç–≤–µ—Ç –æ—Ç –∫–ª–∏–Ω–∏–∫–∏:</b><br><br>${message}`, "ai");
      }

      // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç—É
      showNotification("SmartDoctor", `–û—Ç–≤–µ—Ç –ø–æ –∑–∞—è–≤–∫–µ: ${message.substring(0,50)}...`);

      if (removeAfter) {
        appointments.splice(appIndex, 1);
      }
      localStorage.setItem("sd_appointments", JSON.stringify(appointments));

      renderAdminPanel();
    }

    window.onload = () => {
      translate();
      const savedBg = localStorage.getItem('sd_background') || 'linear-gradient(135deg, #1b38bb 0%, #1249c0 100%)';
      applyBackground(savedBg);
      const saved = localStorage.getItem('sd_current');
      if (saved) {
        currentUser = JSON.parse(saved);
        document.getElementById('userAvatar').src = currentUser.avatar || "https://randomuser.me/api/portraits/men/1.jpg";
        showMainApp();
      }
    };
  </script>
</body>
</html>
